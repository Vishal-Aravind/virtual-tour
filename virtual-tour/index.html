<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>360Â° VR Tour (FullScreen + Split Screen)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <style>
      html, body {
        margin: 0;
        padding: 0;
        height: 100%;
        background-color: black;
        overflow: hidden;
      }
      #enterVRBtn {
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 1000;
        font-size: 18px;
        padding: 12px 20px;
        background-color: #1a73e8;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>

    <!-- Enter VR Button -->
    <button id="enterVRBtn" onclick="goFullscreenAndVR()">Enter VR</button>

    <!-- A-Frame Scene -->
    <a-scene vr-mode-ui="enabled: true" embedded fullscreen="true">
      <!-- Camera with fuse reticle -->
      <a-entity camera look-controls wasd-controls>
        <a-entity 
          cursor="fuse: true; fuseTimeout: 2000"
          position="0 0 -1"
          geometry="primitive: ring; radiusInner: 0.01; radiusOuter: 0.02"
          material="color: white; shader: flat">
        </a-entity>
      </a-entity>

      <!-- 360 Background Image -->
      <a-sky id="sky" src="assets/hall.jpg" rotation="0 -90 0"></a-sky>

      <!-- Hotspot Example -->
      <a-image src="assets/hotspot.png"
               id="hall"
               position="2 1.5 -3"
               width="0.5" height="0.5"
               look-at="[camera]"
               gaze-teleport="target: bedroom1">
      </a-image>

      <a-image src="assets/hotspot.png"
               id="bedroom1"
               visible="false"
               position="-2 1.5 -3"
               width="0.5" height="0.5"
               look-at="[camera]"
               gaze-teleport="target: hall">
      </a-image>

      <script>
        const sky = document.querySelector("#sky");

        const hotspots = {
          hall: document.querySelector("#hall"),
          bedroom1: document.querySelector("#bedroom1")
        };

        const sceneMap = {
          hall:      { src: "assets/hall.jpg",      next: "bedroom1" },
          bedroom1:  { src: "assets/bedroom1.jpg",  next: "hall"     }
        };

        function changeScene(room) {
          sky.setAttribute("src", sceneMap[room].src);
          Object.values(hotspots).forEach(h => h.setAttribute("visible", "false"));
          const nextHotspot = sceneMap[room].next;
          if (hotspots[nextHotspot]) {
            hotspots[nextHotspot].setAttribute("visible", "true");
          }
        }

        AFRAME.registerComponent("gaze-teleport", {
          schema: { target: { type: "string" } },
          init: function () {
            this.el.addEventListener("click", () => {
              changeScene(this.data.target);
            });
          },
        });

        function goFullscreenAndVR() {
          const scene = document.querySelector("a-scene");
          const container = document.documentElement;

          // Fullscreen API
          if (container.requestFullscreen) {
            container.requestFullscreen();
          } else if (container.webkitRequestFullscreen) {
            container.webkitRequestFullscreen();
          } else if (container.mozRequestFullScreen) {
            container.mozRequestFullScreen();
          } else if (container.msRequestFullscreen) {
            container.msRequestFullscreen();
          }

          // Enter VR mode
          if (scene && scene.enterVR) {
            scene.enterVR();
          }
        }
      </script>
    </a-scene>
  </body>
</html>
